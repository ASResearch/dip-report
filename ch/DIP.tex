\section{开发者激励协议}
基于上一章节的模型，本章主要介绍开发者激励协议。DIP包括DApp评分和激励分配两个环节，具体地，从用户调用行为到开发者获取激励包括调用次数到投票效用、投票效用到分贡献值、分贡献值到排名分以及排名分到最终奖励四次转换。

\subsection{投票效用与分贡献值的计算}
对于任何一个用户$a_i$，我们将$\nr_i$定义为该用户的投票效用，即可以理解为用户手中握有的选票总张数。在~\cite{Nebulasyellowpaper}中已经证明了星云指数能够有效衡量账户的价值，因此在DIP中将使用星云指数衡量用户的投票效用。对于用户$a_i$而言，其投票总效用可以表示为用户$a_i$的NR值函数：
\begin{align}
\nr_i = f(\mathcal{C}(a_i))
\end{align}
其中$\mathcal{C}(a_i)$表示为用户$a_i$的星云指数。

通常地我们希望$f$单调递增，即星云指数高的用户可以获得更高的投票权。这里我们给出符合条件的函数：
\begin{align}
f(\mathcal{C}(a_i))=\mathcal{C}^2(a_i)
\end{align}
即
\begin{align}
\nr_i = \mathcal{C}^2(a_i)
\end{align}
%根据章节~\ref{subsec:2.3}的说明我们暂时不考虑用户调用dapp过程中的资金交互。在后面的章节中我们会讨论基于完善的资金流向检测机制下如何引入资金交互来扩展该模型。
该表达式具有一些良好特性，例如抗女巫攻击，具体分析见第~\ref{section:properties}章节。

接下来我们讨论投票效用分配机制，根据~\ref{section:properties}小节，$\nr_{ij}$表示为用户$a_i$对DApp $d_j$的分贡献值，其定义为
\begin{align}
\label{eq:vote_rate}
\nr_{ij} = \frac{e_{ij}}{e_{i0}+\sum_{j=1}^n {e_{ij}}} \nr_i
\end{align}
%$$  \nr_{ij} = \frac{e_{ij}}{e_{i0}+\sum_{j=1}^n {e_{ij}}} \nr_i$$
式~\ref{eq:vote_rate}可以理解为对$d_j$调用次数在总调用次数上的占比。这里$e_{i0}$表示$a_i$对于不属于上述任何一个DApp的调用次数。用户$a_i$可以任意调整$e_{i0}$以及$e_{ij}$的数值。

%%定义
%$$  NR_{i0} = \frac{e_{i0}}{e_{i0}+\sum_{j=1}^n {e_{ij}}}$$
由于$e_{i0}$的引入，不难得出
$$\sum_{j=1}^n \nr_{ij} \leq \nr_i$$
\noindent 式~\ref{eq:vote_rate}需要达到的目的仅仅是让用户可以任意分配自己的星云指数用于投票（即任意选择分贡献值）。实际上有些DApp可能采取强行增加调用次数的手段（比如规定必须调用两次才生效），但因为用户调用次数和星云指数都是可见的，用户仍然可以通过调整调用次数来达到自己期望达到的贡献值分配方式。
%并且即使我们不是根据次数线性分配NR而是采用其他方式，聪明的用户总能找到其他投票方案以实现（期望达到的NR值分配方式）。

引入$e_{i0}$的意义在于，为了保证用户的个人理性（individual rationality），即用户参加此次活动不会损失利益，我们不强制用户投出所有的选票。用户可以选择性的行使部分投票权或完全弃权，通过适量增加$e_{i0}$的值。\footnote{$e_{i0}$的实现可以通过官方设立一个空智能合约，不含任何实际效用。用户可以调用该智能合约任意次数。}这适用于用户觉得质量上乘的DApp太少的情况。

%因为一个用户投票的dapp数目过多对于区分该用户心中优秀dapp意义不大，且容易造成用户贡献值过大以及后面会出现的拉平效应等问题，我们只取该用户分贡献值排名前$K$的dapp，即设$NR_{ij_1},...,NR_{ij_k}$为用户$a_i$前$K$大的分贡献值（可以包括$NR_{i0}$），将他们的值归一化为
%$$NR_{ij_{k}} \rightarrow NR_{ij_{k}} \times \frac{NR_i}{\sum_{t=1}^K NR_{ij_{t}}}, \forall k=1,2,...,K$$
%且对所有排名在$K$以后的分贡献值将它们全部置为0。

\subsection{排名分的计算}
在得到用户的分贡献值后，我们可以计算DApp的排名分。给定所有的分贡献值$\nr_{ij}, i=1,2,...,m,j=1,2,...,n$，我们将DApp $d_j$的排名分定义为关于所有调用用户的分贡献值的函数：
\begin{align}
S_j = g(\nr_{1j},\nr_{2j},...,\nr_{mj})
\end{align}
同样地，这里我们给出一个符合条件的函数：
\begin{align}
\label{eq:sqrt}
g(\nr_{1j},\nr_{2j},...,\nr_{mj}) = \sum_{i=1}^m \sqrt{\nr_{ij}}
\end{align}

即DApp的排名分为所有调用其用户的分贡献值的开方和。对于用户$a_i$而言，其只投票给一个DApp时（在不弃权情况下），他的投票分贡献值之和为$\sqrt{\nr_i}$。而当他将票分散给不同的DApp时，根据开方函数$\sqrt{a+b}<\sqrt{a}+\sqrt{b}$的性质，他投票的总效用会提高。这意味着他接触了更多的DApp，而这也是我们的系统所鼓励的。在~\ref{section:properties}章节将会给出这样构造排名分的方法的详细分析以及性质证明，类似的相关分析在论文~\cite{buterin2018liberal}中也有提及。

%类似的思想可用见于V神的论文~\cite{buterin2018liberal}里面用到的二阶投票算法，虽然两者的模型完全不同。

当排名分$S_j$给出之后，即可以根据排名分对DApp进行排名。例如在星云NAS nano客户端\footnote{\url{https://nano.nebulas.io/}}中，排名分高的DApp将被放在更显著的位置，也会受到更多的关注。

%值得一提的是

\subsection{最终奖励的计算}
DIP对于用户而言提供了可信的DApp排名\footnote{我们假设用户只关心心目中的DApp的排名，而不会关心DApp开发者具体分配到多少奖励。}，而对于开发者而言，我们还需要根据排名分进行奖励分配。

给定所有DApp的排名分$S_j,i=1,2,...,n$，定义DApp $d_j$开发者的奖励为
\begin{align}
\label{eq:distribution}
U_i = \frac{S_j^2}{\sum_{k=1}^n S_j^2}\cdot \lambda M
\end{align}
其中$M$是来源于出块奖励的奖金池总数，$\lambda $定义为参与系数，即我们希望参与评选的用户总NR值越多给的奖励总额越大，具体定义为
\begin{align}
\lambda=\min\{\frac{\nr_p}{\alpha \nr_s }\cdot \min\{\frac{\beta\nr_p^2 }{\sigma^2(\nr_p)},1\},1\}
\end{align}
其中$$\nr_p = \sum_{i=1}^m (\nr_i-\nr_{i0}),~~~\nr_{i0} = \frac{e_{i0}\nr_i}{e_{i0}+\sum_{j=1}^n {e_{ij}}}$$
即$\nr_p$为参与投票的用户有效分贡献之和，同时$$\nr_s = \sum_{i=1}^{m^*} (\nr_i-\nr_{i0})$$即$\nr_s$为社区所有用户投票效用值（NR值的平方）的总和。$\sigma$为参与投票用户有效分贡献的标准差（方差的开方），
$$ \sigma^2(\nr_p) = \sum_{i=1}^m (\nr_i-\frac{1}{m}\nr_p)^2 $$
其最大值为$\frac{(m-1)^2}{m^2}\nr_p^2$。
$\alpha,\beta<1$为可调的参数。

引入参与系数目的是期望参与活动的用户总效用达到某个阈值（社区总效用的$\alpha$倍），以及让参与评选用户效用值的方差限定在某个范围内，防止出现少量高NR值用户带大量虚假账户的情况。两者可互补，即参与投票用户NR总值够高时可以不考虑方差的影响。
%\subsection{关于策略调整}
%我们始终把维护星云生态的健康发展当作星云人首要任务，而维护星云之上开发者、推广者及用户的利益更是星云人责无旁贷的义务。对于星云而言，不同的发展阶段其利益诉求也不尽相同，我们始终聆听来自社区的各种声音，响应不同的利益诉求。

%为此，对于此次评选中的算法，我们保留进一步调整的可能性，以响应社区中对于利益的不同诉求。
